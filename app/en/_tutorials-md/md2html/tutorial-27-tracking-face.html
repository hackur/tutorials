<hr>
<p>tag: tutorial
src: tutorial-27-tracking-face.html
title: Controlling LEDs with face tracking
banner: tutorial-27-01.jpg
img: tutorial-27-01s.jpg</p>
<h2>date: 20160308</h2>
<!-- @@master  = ../../_layout.html-->
<!-- @@block  =  meta-->
<title>Project Example 27: Controlling LEDs with face tracking :::: Webduino = Web × Arduino</title>

<meta name="description" content="With web browsers evolving, we can use new web technology to satisfy a once distant dream! In this tutorial, we will be using a webcam for facial recognition and tracking, and controlling LEDs according to its position.">

<meta itemprop="description" content="With web browsers evolving, we can use new web technology to satisfy a once distant dream! In this tutorial, we will be using a webcam for facial recognition and tracking, and controlling LEDs according to its position.">

<meta property="og:description" content="With web browsers evolving, we can use new web technology to satisfy a once distant dream! In this tutorial, we will be using a webcam for facial recognition and tracking, and controlling LEDs according to its position.">

<meta property="og:title" content="Project Example 27: Controlling LEDs with face tracking" >

<meta property="og:url" content="https://webduino.io/tutorials/tutorial-27-tracking-face.html">

<meta property="og:image" content="https://webduino.io/img/tutorials/tutorial-27-01s.jpg">

<meta itemprop="image" content="https://webduino.io/img/tutorials/tutorial-27-01s.jpg">

<include src="../_include-tutorials.html"></include>

<!-- @@close-->
<!-- @@block  =  preAndNext-->
<include src="../_include-tutorials-content.html"></include>

<!-- @@close-->
<!-- @@block  =  tutorials-->
<h1>Project Example 27: Controlling LEDs with face tracking</h1>
<p>With web browsers evolving, we can use new web technology to satisfy a once distant dream! In this tutorial, we will be using a webcam for facial recognition and tracking, and controlling LEDs according to its position.</p>
<!-- <div class="buy-this">
    <span>LED 相關套件：<a href="https://webduino.io/buy/webduino-package-plus.html" target="_blank">Webduino 基本套件 Plus ( 支援馬克 1 號、Fly )</a></span>
    <span>Webduino 開發板：<a href="https://webduino.io/buy/component-webduino-v1.html" target="_blank">Webduino 馬克一號</a>、<a href="https://webduino.io/buy/component-webduino-fly.html" target="_blank">Webduino Fly</a>、<a href="https://webduino.io/buy/component-webduino-uno-fly.html" target="_blank">Webduino Fly + Arduino UNO</a></span>
</div> -->
<h2>Video Tutorial</h2>
<p>Watch the video tutorial here:
<iframe class="youtube" src="https://www.youtube.com/embed/GxOh2Gv9GJA" frameborder="0" allowfullscreen></iframe></p>
<h2>Wiring and Practice</h2>
<p>This tutorial only uses one LED. Plug the LED directly into the board or use a breadboard and jumper wires. In this tutorial, <strong>connect the longer leg to 10 and the shorter leg to GND</strong>.</p>
<p>Webduino Mark 1 Circuit diagram:</p>
<p><img src="../../img/tutorials/tutorial-27-02.jpg" alt=""></p>
<p>Webduino Fly Circuit diagram:</p>
<p><img src="../../img/tutorials/tutorial-27-02-fly.jpg" alt=""></p>
<p>Reference image:</p>
<p><img src="../../img/tutorials/tutorial-27-03.jpg" alt=""></p>
<!-- <div class="buy-this">
    <span>LED 相關套件：<a href="https://webduino.io/buy/webduino-package-plus.html" target="_blank">Webduino 基本套件 Plus ( 支援馬克 1 號、Fly )</a></span>
    <span>Webduino 開發板：<a href="https://webduino.io/buy/component-webduino-v1.html" target="_blank">Webduino 馬克一號</a>、<a href="https://webduino.io/buy/component-webduino-fly.html" target="_blank">Webduino Fly</a>、<a href="https://webduino.io/buy/component-webduino-uno-fly.html" target="_blank">Webduino Fly + Arduino UNO</a></span>
</div> -->
<h2>Instructions for using the Webduino Blockly</h2>
<p>Open the <a href="https://blockly.webduino.io/index.html?lang=en">Webduino Blockly editor</a>, click on &quot;Web Demo Area&quot; on the upper right corner, and choose &quot;Tracking&quot; from the drop-down list.</p>
<p><img src="../../img/tutorials/en/tutorial-27-04.jpg" alt=""></p>
<p>Place a &quot;Board&quot; block onto the workspace and enter the Webduino board name. Then place a &quot;Set LED to&quot; block inside and set the name to led, pin to 10.</p>
<p><img src="../../img/tutorials/en/tutorial-27-05.jpg" alt=""></p>
<p>We will be using the &quot;Tracking&quot; blocks from the &quot;Web Demo&quot; menu for this stack.</p>
<p><img src="../../img/tutorials/en/tutorial-27-06.jpg" alt=""></p>
<p>First place a &quot;Set tracking&quot; block in the stack, it can set it to track &quot;face&quot; or &quot;color&quot;, here we set it to &quot;face&quot;. </p>
<p><img src="../../img/tutorials/en/tutorial-27-07.jpg" alt=""></p>
<p>Inside the tracking block add an &quot;If Do Else&quot; block from &quot;Logic&quot; menu, with a logic equation block connected. Place a &quot;Tracking value&quot; block inside the equation set to &quot;Greater than&quot; and the number set to 100. Add two &quot;LED Set state&quot; blocks to the &quot;Do&quot; and &quot;Else&quot; sections of the logic block. Set them to &quot;On&quot; and &quot;Off&quot; respectively. This will turn the LED on when the x-axis is greater than 100, and turn off when it is less than 100.</p>
<p><img src="../../img/tutorials/en/tutorial-27-08.jpg" alt=""></p>
<p>If you click on the drop-down menu, you can see that it allows us to track the x-axis, y-axis, width, height, total and color.</p>
<p><img src="../../img/tutorials/en/tutorial-27-09.jpg" alt=""></p>
<p>Last, add the &quot;Track start tracking&quot; block to the bottom of the stack. Confirm that the board is online (click &quot;<a href="https://webduino.io/device.html">Check Device Status</a>&quot;), click on the red execution button &quot;Run Blocks&quot;, and you will see images streaming from your webcam onto the Web Demo area on the right hand side of your screen.</p>
<p><img src="../../img/tutorials/en/tutorial-27-10.jpg" alt=""></p>
<p>If you don&#39;t see anything, your browser may be trying to protect you from privacy or safety issues, so the webcam will be disabled, A simple fix would be to change your protocol identifier in your web browser&#39;s address bar from http to https.</p>
<p><img src="../../img/tutorials/en/tutorial-27-11.jpg" alt=""></p>
<p>If you&#39;d like to know the values currently being tracked, we can use the &quot;Console&quot; block from the &quot;Advanced&quot; menu with a &quot;Tracking value&quot; block connected to it placed inside of the &quot;Set tracking&quot; block. You will need your browser&#39;s console to be open as well, press F12 if you are using windows or option + command + i for Macs.</p>
<p><img src="../../img/tutorials/en/tutorial-27-12.jpg" alt=""></p>
<p>Now you can use face tracking! 
Solution: <a href="https://blockly.webduino.io/?lang=en#-KYkzZOoD6aAOhnTKxGy">https://blockly.webduino.io/?lang=en#-KYkzZOoD6aAOhnTKxGy</a></p>
<h2>Code Explanation (<a href="https://bin.webduino.io/famar/1/edit?html,css,js,output">Check Webduino Bin</a>, <a href="https://webduino.io/device.html">Check Device Status</a>)</h2>
<p>Include <code>webduino-all.min.js</code> in the header of your html files in order to support all of the Webduino&#39;s components. If the codes are generated by Webduino Blockly, you also have to include <code>webduino-blockly.js</code> in your files.</p>
<pre><code>&lt;script src=&quot;https://webduino.io/components/webduino-js/dist/webduino-all.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://webduinoio.github.io/webduino-blockly/webduino-blockly.js&quot;&gt;&lt;/script&gt;
</code></pre><p>Aside from the 2 pieces of JavaScript code above, we&#39;ve used 2 Open Source programs, tracking-min.js and face-min.js. We can only use face tracking after we&#39;ve imported these two.</p>
<pre><code>&lt;script src=&quot;https://blockly.webduino.io/lib/tracking-min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://blockly.webduino.io/lib/face-min.js&quot;&gt;&lt;/script&gt;
</code></pre><p>Inside HTML there are video and canvas, both on the same side, we use video to show the streamed video and canvas to analyze and detect faces, using a red box to define the face.</p>
<pre><code>&lt;div id=&quot;demo-area-08-content&quot;&gt;
  &lt;video id=&quot;demo-area-08-video&quot; preload=&quot;&quot; autoplay=&quot;&quot; loop=&quot;&quot; muted=&quot;&quot; controls=&quot;&quot;&gt;&lt;/video&gt;
  &lt;canvas id=&quot;demo-area-08-canvas&quot;&gt;&lt;/canvas&gt;
&lt;/div&gt;
</code></pre><p>CSS is used to define the size for video and canvas.</p>
<pre><code>#demo-area-08-content {
  position: relative;
  width: 100%;
  max-width: 300px;
  height: 200px;
}

#demo-area-08-video {
  top: 0;
  left: 0;
  position: absolute;
  width: 100%;
  height: 100%;
}

#demo-area-08-canvas {
  top: 0;
  left: 0;
  position: absolute;
  width: 100%;
  height: 100%;
}
</code></pre><p>We use a bit more of JavaScript here, mostly for tracking. There is also some settings: <code>setInitialScale</code>, <code>setStepSize</code>, <code>setEdgesDensity</code>, each representing scale, frequency, and depth. If we use higher settings, our computer will need more CPU and memory power, if we are looking for speed, then we could use lower settings, but then the accuracy of the tracking will also be lower. (Details can be found here: <a href="https://trackingjs.com/">https://trackingjs.com/</a>)  </p>
<p>If you&#39;d like to set the box color, you can change <code>strokeStyle</code>, which defaults to red #f00. Use a simple if-else statement that takes into account the x-axis, y-axis, width, height, and total from the data. Note that there is no total when we use color.</p>
<pre><code>var led;
var track;

boardReady(&#39;&#39;, function (board) {
  board.samplingInterval = 20;
  led = getLed(board, 10);
  track = {};
  track.canvas = document.getElementById(&quot;demo-area-08-canvas&quot;);
  track.context = track.canvas.getContext(&quot;2d&quot;);
  track.myTracker = new tracking.ObjectTracker(&quot;face&quot;);
  track.myTracker.setInitialScale(4);
  track.myTracker.setStepSize(0.5);
  track.myTracker.setEdgesDensity(0.1);

  track.myTracker.on(&quot;track&quot;, function(event) {
    if (event.data.length === 0) {
      track.context.clearRect(0, 0, track.canvas.width, track.canvas.height);
    } else {
      track.context.clearRect(0, 0, track.canvas.width, track.canvas.height);
      event.data.forEach(function(data) {
        console.log(data.x);
    if (data.x &gt; 100) {
      led.on();
    } else {
      led.off();
    }
        if(data.color){
          track.context.strokeStyle = track.storkColor[data.color];
        }else{
          track.context.strokeStyle = &quot;#f00&quot;;
        }
        track.context.lineWidth = 5;
        track.context.strokeRect(data.x, data.y, data.width, data.height-30);
        track.context.font = &quot;11px Helvetica&quot;;
        track.context.fillStyle = &quot;#fff&quot;;
      });
    }
  });
  track.trackerTask = tracking.track(&quot;#demo-area-08-video&quot;, track.myTracker, {
    camera: true
  });

  track.context.clearRect(0, 0, track.canvas.width, track.canvas.height);
  track.trackerTask.run();
});
</code></pre><p>Now this is how you do face tracking with the Webduino Blockly!<br>Webduino Bin: <a href="https://bin.webduino.io/famar/1/edit?html,css,js,output">https://bin.webduino.io/famar/1/edit?html,css,js,output</a><br>Stack setup: <a href="https://blockly.webduino.io/?lang=en#-KYl132eWIGsHKjvCQYA">https://blockly.webduino.io/?lang=en#-KYl132eWIGsHKjvCQYA</a></p>
<!-- <div class="buy-this">
    <span>LED 相關套件：<a href="https://webduino.io/buy/webduino-package-plus.html" target="_blank">Webduino 基本套件 Plus ( 支援馬克 1 號、Fly )</a></span>
    <span>Webduino 開發板：<a href="https://webduino.io/buy/component-webduino-v1.html" target="_blank">Webduino 馬克一號</a>、<a href="https://webduino.io/buy/component-webduino-fly.html" target="_blank">Webduino Fly</a>、<a href="https://webduino.io/buy/component-webduino-uno-fly.html" target="_blank">Webduino Fly + Arduino UNO</a></span>
</div> -->
<!-- @@close-->